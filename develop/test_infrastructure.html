
<!DOCTYPE html>

<html lang="zh_CN">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta property="og:title" content="Testing Infrastructure" />
  <meta property="og:type" content="website" />
  <meta property="og:url" content="https://myst-parser.readthedocs.io/en/develop/test_infrastructure.html" />
  <meta property="og:description" content="Where possible, additions to the code should be carried out in a test-driven development manner: Write failing tests that the code should pass, then write code to pass the tests. The tests are run ..." />
  <meta property="og:image" content="https://repository-images.githubusercontent.com/240151150/316bc480-cc23-11eb-96fc-4ab2f981a65d" />
  <meta property="og:image:alt" content="Testing Infrastructure" />
  <meta name="twitter:card" content="summary_large_image">
    <title>Testing Infrastructure</title>
    
  <link href="../_static/css/theme.css" rel="stylesheet">
  <link href="../_static/css/index.ff1ffe594081f20da1ef19478df9384b.css" rel="stylesheet">

    
  <link rel="stylesheet"
    href="../_static/vendor/fontawesome/5.13.0/css/all.min.css">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2">

    
      

    
    <link rel="stylesheet" type="text/css" href="../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../_static/sphinx-book-theme.css?digest=c3fdc42140077d1ad13ad2f1588a4309" />
    <link rel="stylesheet" type="text/css" href="../_static/custom.css" />
    <link rel="stylesheet" type="text/css" href="../_static/panels-main.c949a650a448cc0ae9fd3441c0e17fb0.css" />
    <link rel="stylesheet" type="text/css" href="../_static/panels-variables.06eb56fa6e07937060861dad626602ad.css" />
    
  <link rel="preload" as="script" href="../_static/js/index.be7d3bbb2ef33a8344ce.js">

    <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/doctools.js"></script>
    <script src="../_static/translations.js"></script>
    <script src="../_static/sphinx-book-theme.12a9622fbb08dcb3a2a40b2c02b83a57.js"></script>
    <script src="https://unpkg.com/mermaid/dist/mermaid.min.js"></script>
    <script>mermaid.initialize({startOnLoad:true});</script>
    <link rel="shortcut icon" href="../_static/logo-square.svg"/>
    <link rel="index" title="索引" href="../genindex.html" />
    <link rel="search" title="搜索" href="../search.html" />
    <link rel="next" title="Example pages" href="../examples/index.html" />
    <link rel="prev" title="The MyST implementation architecture" href="architecture.html" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="docsearch:language" content="zh_CN">
    

    <!-- Google Analytics -->
    
  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="80">
    
    <div class="container-fluid" id="banner"></div>

    

    <div class="container-xl">
      <div class="row">
          
<div class="col-12 col-md-3 bd-sidebar site-navigation show" id="site-navigation">
    
        <div class="navbar-brand-box">
    <a class="navbar-brand text-wrap" href="../index.html">
      
        <!-- `logo` is deprecated in Sphinx 4.0, so remove this when we stop supporting 3 -->
        
      
      
      <img src="../_static/logo-wide.svg" class="logo" alt="logo">
      
      
    </a>
</div><form class="bd-search d-flex align-items-center" action="../search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search the docs ..." aria-label="Search the docs ..." autocomplete="off" >
</form><nav class="bd-links" id="bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item active">
        <ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../sphinx/intro.html">
   Get started with MyST in Sphinx
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  MyST 语法
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../syntax/syntax.html">
   The MyST Syntax Guide
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../syntax/optional.html">
   Optional MyST Syntaxes
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../syntax/reference.html">
   MyST Syntax Reference
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  主题指南
 </span>
</p>
<ul class="current nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../explain/index.html">
   Background and explanation
  </a>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../sphinx/index.html">
   MyST with Sphinx
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-1" name="toctree-checkbox-1" type="checkbox"/>
  <label for="toctree-checkbox-1">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../sphinx/use.html">
     Sphinx extension usage guide
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../sphinx/roles-and-directives.html">
     Special roles and directives
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../sphinx/reference.html">
     Sphinx configuration options
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../sphinx/faq.html">
     Common errors and questions
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../api/index.html">
   MyST-Parser Python API
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-2" name="toctree-checkbox-2" type="checkbox"/>
  <label for="toctree-checkbox-2">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../api/parsers.html">
     Parse MyST Markdown
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../api/renderers.html">
     Render outputs
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../api/reference.html">
     API Reference
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 current active has-children">
  <a class="reference internal" href="index.html">
   Contribute to MyST
  </a>
  <input checked="" class="toctree-checkbox" id="toctree-checkbox-3" name="toctree-checkbox-3" type="checkbox"/>
  <label for="toctree-checkbox-3">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul class="current">
   <li class="toctree-l2">
    <a class="reference internal" href="contributing.html">
     Contributing
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="architecture.html">
     The MyST implementation architecture
    </a>
   </li>
   <li class="toctree-l2 current active">
    <a class="current reference internal" href="#">
     Testing Infrastructure
    </a>
   </li>
  </ul>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  关于
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../examples/index.html">
   Example pages
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-4" name="toctree-checkbox-4" type="checkbox"/>
  <label for="toctree-checkbox-4">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../examples/wealth_dynamics_rst.html">
     Wealth Distribution Dynamics in rST
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../examples/wealth_dynamics_md.html">
     Wealth Distribution Dynamics in MyST
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="_changelog.html">
   Changelog
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference external" href="https://github.com/executablebooks/myst-parser">
   GitHub 仓库
  </a>
 </li>
</ul>

    </div>
</nav> <!-- To handle the deprecated key -->

<div class="navbar_extra_footer">
  Theme by the <a href="https://ebp.jupyterbook.org">Executable Book Project</a>
</div>

</div>


          


          
<main class="col py-md-3 pl-md-4 bd-content overflow-auto" role="main">
    
    <div class="topbar container-xl fixed-top">
    <div class="topbar-contents row">
        <div class="col-12 col-md-3 bd-topbar-whitespace site-navigation show"></div>
        <div class="col pl-md-4 topbar-main">
            
            <button id="navbar-toggler" class="navbar-toggler ml-0" type="button" data-toggle="collapse"
                data-toggle="tooltip" data-placement="bottom" data-target=".site-navigation" aria-controls="navbar-menu"
                aria-expanded="true" aria-label="Toggle navigation" aria-controls="site-navigation"
                title="Toggle navigation" data-toggle="tooltip" data-placement="left">
                <i class="fas fa-bars"></i>
                <i class="fas fa-arrow-left"></i>
                <i class="fas fa-arrow-up"></i>
            </button>
            
            
<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn" aria-label="Download this page"><i
            class="fas fa-download"></i></button>

    <div class="dropdown-buttons">
        <!-- ipynb file if we had a myst markdown file -->
        
        <!-- Download raw file -->
        <a class="dropdown-buttons" href="../_sources/develop/test_infrastructure.md.txt"><button type="button"
                class="btn btn-secondary topbarbtn" title="Download source file" data-toggle="tooltip"
                data-placement="left">.md</button></a>
        <!-- Download PDF via print -->
        <button type="button" id="download-print" class="btn btn-secondary topbarbtn" title="Print to PDF"
            onClick="window.print()" data-toggle="tooltip" data-placement="left">.pdf</button>
    </div>
</div>

            <!-- Source interaction buttons -->

<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn"
        aria-label="Connect with source repository"><i class="fab fa-github"></i></button>
    <div class="dropdown-buttons sourcebuttons">
        
        
        <a class="edit-button" href="https://github.com/executablebooks/MyST-Parser/edit/master/docs/develop/test_infrastructure.md"><button
                type="button" class="btn btn-secondary topbarbtn" data-toggle="tooltip" data-placement="left"
                title="Edit this page"><i class="fas fa-pencil-alt"></i>suggest edit</button></a>
    </div>
</div>

            <!-- Full screen (wrap in <a> to have style consistency -->

<a class="full-screen-button"><button type="button" class="btn btn-secondary topbarbtn" data-toggle="tooltip"
        data-placement="bottom" onclick="toggleFullScreen()" aria-label="Fullscreen mode"
        title="Fullscreen mode"><i
            class="fas fa-expand"></i></button></a>

            <!-- Launch buttons -->

        </div>

        <!-- Table of contents -->
        <div class="d-none d-md-block col-md-2 bd-toc show">
            
            <div class="tocsection onthispage pt-5 pb-3">
                <i class="fas fa-list"></i> Contents
            </div>
            <nav id="bd-toc-nav" aria-label="Page">
                <ul class="visible nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#test-tools">
   Test tools
  </a>
 </li>
</ul>

            </nav>
        </div>
    </div>
</div>
    <div id="main-content" class="row">
        <div class="col-12 col-md-9 pl-md-3 pr-md-0">
        
              <div>
                
  <div class="tex2jax_ignore mathjax_ignore section" id="testing-infrastructure">
<span id="develop-testing"></span><h1>Testing Infrastructure<a class="headerlink" href="#testing-infrastructure" title="永久链接至标题">¶</a></h1>
<p>Where possible, additions to the code should be carried out in a
<a class="reference external" href="https://en.wikipedia.org/wiki/Test-driven_development">test-driven development</a>
manner:</p>
<blockquote>
<div><p><strong>Write failing tests that the code should pass, then write code to pass the tests</strong>.</p>
</div></blockquote>
<p>The tests are run using <a class="reference external" href="https://docs.pytest.org">pytest</a>/<a class="reference external" href="https://github.com/features/actions">GitHub Actions</a> for unit tests, and <a class="reference external" href="https://readthedocs.org/">readthedocs</a> for documentation build tests.</p>
<p>The tests are ordered in a hierarchical fashion:</p>
<ol class="arabic simple">
<li><p>In <code class="docutils literal notranslate"><span class="pre">tests/test_commonmark</span></code> the <a class="reference external" href="https://github.com/commonmark/CommonMark.git">CommonMark</a> test set is run to check that the parser is complying with the CommonMark specification.</p></li>
<li><p>In <code class="docutils literal notranslate"><span class="pre">tests/test_renderers</span></code> are tests that check that the Markdown AST is being correctly converted to the docutils/sphinx AST. This includes testing that roles and directives are correctly parsed and run.</p></li>
<li><p>In <code class="docutils literal notranslate"><span class="pre">tests/test_sphinx</span></code> are tests that check that minimal sphinx project builds are running correctly, to convert MyST markdown files to HTML.</p></li>
<li><p>In <code class="docutils literal notranslate"><span class="pre">.circleci</span></code> the package documentation (written in MyST format) is built and tested for build errors/warnings.</p></li>
</ol>
<div class="section" id="test-tools">
<h2>Test tools<a class="headerlink" href="#test-tools" title="永久链接至标题">¶</a></h2>
<p><a class="reference external" href="https://pytest-regressions.readthedocs.io"><strong>pytest-regressions</strong></a> is a pytest plugin
that is used in the test suite, to maintain tests that generate lots of data.
In particular, they are used in the syntax testing to generate tests for AST trees
which may change in the future due to changes/additions to the data captured by the parser.
For example, after writing:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">test_example_dict</span><span class="p">(</span><span class="n">data_regression</span><span class="p">):</span>
    <span class="n">data_regression</span><span class="o">.</span><span class="n">check</span><span class="p">({</span>
        <span class="s2">&quot;key1&quot;</span><span class="p">:</span> <span class="s2">&quot;value1&quot;</span><span class="p">,</span>
        <span class="s2">&quot;key2&quot;</span><span class="p">:</span> <span class="s2">&quot;value2&quot;</span><span class="p">,</span>
        <span class="s2">&quot;more&quot;</span><span class="p">:</span> <span class="s2">&quot;data...&quot;</span><span class="p">,</span>
    <span class="p">})</span>
<span class="k">def</span> <span class="nf">test_example_str</span><span class="p">(</span><span class="n">file_regression</span><span class="p">):</span>
    <span class="n">file_regression</span><span class="o">.</span><span class="n">check</span><span class="p">(</span><span class="s2">&quot;a very long string...&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>Running the following will initially fail,
but will also generate a file (per test) of expected output:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span>pytest -k test_example
</pre></div>
</div>
<p>Subsequent times the tests are run, the tests output will now be validated against these stored files.</p>
<p>After a change to the syntax parser, all failing tests can then be ‘regenerated’ with the new
expected output, by running:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span>pytest --force-regen
</pre></div>
</div>
</div>
</div>


              </div>
              
        
            <!-- Previous / next buttons -->
<div class='prev-next-area'> 
    <a class='left-prev' id="prev-link" href="architecture.html" title="上一页 页">
        <i class="fas fa-angle-left"></i>
        <div class="prev-next-info">
            <p class="prev-next-subtitle">上一页</p>
            <p class="prev-next-title">The MyST implementation architecture</p>
        </div>
    </a>
    <a class='right-next' id="next-link" href="../examples/index.html" title="下一页 页">
    <div class="prev-next-info">
        <p class="prev-next-subtitle">下一页</p>
        <p class="prev-next-title">Example pages</p>
    </div>
    <i class="fas fa-angle-right"></i>
    </a>
</div>
        
        </div>
    </div>
    <footer class="footer">
    <div class="container">
      <p>
        
          By Executable Book Project<br/>
        
            &copy; Copyright 2020, Executable Book Project.<br/>
      </p>
    </div>
  </footer>
</main>


      </div>
    </div>
  
  <script src="../_static/js/index.be7d3bbb2ef33a8344ce.js"></script>

  </body>
</html>